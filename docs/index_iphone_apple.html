<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1"/>
  <title>Hub ASSERT • iPhone • Apple Style</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    :root{
      --bg:#0d0f14;
      --fg:#eaf6ff;
      --muted:#a7c1cc;
      --card:#121521;
      --acc:#00d1ff;
      --gold:#D4AF37;
      --radius:24px;
      --ring:#00d1ff55;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: rgba(255,255,255,0);}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Inter, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 600px at 50% -10%, rgba(0,209,255,.10), transparent 60%),
        linear-gradient(180deg,#0a0c12 0%, #0d0f14 40%, #0a0b0f 100%);
      transition: background .4s ease;
      display:flex;
      flex-direction:column;
      min-height:100vh;
      overscroll-behavior-y: contain;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    body.theme-lux{
      background:
        radial-gradient(900px 600px at 50% -10%, rgba(212,175,55,.10), transparent 60%),
        linear-gradient(180deg,#0b0b0b 0%, #0c0c0c 40%, #0a0a0a 100%);
    }

    /* Header — compacto, translúcido, com área segura */
    .header{
      position:sticky; top:0; z-index:10;
      backdrop-filter:saturate(160%) blur(14px);
      background:rgba(13,15,20,.55);
      border-bottom:1px solid #ffffff12;
      padding-top: env(safe-area-inset-top);
    }
    .inner{
      max-width:420px;
      margin:0 auto;
      padding:10px 14px;
      display:flex; gap:10px; align-items:center;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      background: conic-gradient(from 0deg, var(--acc), #6ee7ff, var(--acc));
      position:relative; box-shadow: 0 0 0 2px #0008, inset 0 0 20px #000;
      animation:pulse 2.8s infinite ease-in-out;
    }
    .logo::after{
      content:"A"; display:grid; place-items:center;
      position:absolute; inset:0;
      font-weight:900; color:#001218; font-size:18px;
      text-shadow:0 0 12px #00d1ff88;
    }
    @keyframes pulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.04)} }

    h1{ font-size:1.1rem; margin:0; font-weight:800; letter-spacing:.2px }
    .kicker{ font-size:.72rem; letter-spacing:.1em; color:var(--muted); text-transform:uppercase }

    /* Segmented control (iOS) */
    .seg{
      display:flex; gap:6px; padding:4px; border-radius:12px;
      background:rgba(255,255,255,.05); border:1px solid #ffffff14;
    }
    .seg button{
      appearance:none; -webkit-appearance:none;
      border:none; padding:8px 10px; border-radius:10px;
      background:transparent; color:#cdefff; font-weight:700; font-size:.84rem;
    }
    .seg button.active{
      background:linear-gradient(180deg,#1b2732,#121a24);
      box-shadow: 0 0 0 2px var(--ring) inset;
    }

    /* Conteúdo centralizado para iPhone */
    main{
      flex:1; display:flex; align-items:center; justify-content:center;
      padding: clamp(14px, 3.5vh, 28px) 14px calc(18px + env(safe-area-inset-bottom));
    }
    .grid{
      width:100%;
      max-width:420px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }

    /* Card Apple-style */
    .card{
      display:flex; gap:12px; align-items:center;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid #ffffff10;
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 14px 32px rgba(0,0,0,.35);
      transition: transform .14s ease, box-shadow .14s ease;
    }
    .card:active{ transform: scale(.985); box-shadow:0 8px 22px rgba(0,0,0,.35) }

    .icon{
      width:62px; height:62px; border-radius:18px; overflow:hidden;
      background:#0f1320; border:1px solid #00d1ff33;
      display:grid; place-items:center; font-size:26px; flex: 0 0 auto;
    }
    .title{ font-weight:900; letter-spacing:.2px; font-size:1.02rem }
    .muted{ color:var(--muted); font-size:.88rem }

    .row{ display:grid; grid-template-columns:1fr; gap:8px; margin-top:10px }
    .btn{
      appearance:none; -webkit-appearance:none;
      border:none; cursor:pointer; width:100%;
      background:linear-gradient(180deg,#f7f7f7,#e8e8e8);
      color:#0d0f14; font-weight:800; border-radius:14px; padding:12px 14px;
      letter-spacing:.2px;
    }
    .btn.secondary{
      background:linear-gradient(180deg,#162231,#0f1723);
      color:#cdefff; border:1px solid #1a2b33;
    }

    footer{
      color:#9bb4c4; font-size:.78rem; text-align:center;
      padding:10px 0 calc(10px + env(safe-area-inset-bottom));
    }

    /* Viewer fullscreen com gesto de swipe-down para fechar */
    .viewer{
      position:fixed; inset:0; z-index:20; display:none;
      align-items:center; justify-content:center; padding:0;
      background: #000b; backdrop-filter: blur(6px);
    }
    .viewer.show{ display:flex }
    .frame{
      width:100%; height:100vh; border-radius: 0;
      border:0; overflow:hidden; background:#0f1117;
      display:flex; flex-direction:column;
    }
    .bar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 12px calc(10px + env(safe-area-inset-top));
      padding-top: calc(8px + env(safe-area-inset-top));
      border-bottom:1px solid #ffffff18;
      background: linear-gradient(180deg,#0a0f14,#0b1116);
    }
    .bar .left{ display:flex; align-items:center; gap:10px }
    .dot{ width:10px; height:10px; border-radius:50%; background:#00d1ff }
    .barTitle{ font-weight:800 }
    .iframe{ flex:1; width:100%; border:0 }
    .loader{
      position:absolute; inset:48px 0 0 0;
      display:grid; place-items:center;
      background: linear-gradient(180deg,#0a0f14ee,#0b0f14dd);
      backdrop-filter: blur(2px);
      transition: opacity .25s ease;
      opacity:0; pointer-events:none;
    }
    .loader.show{ opacity:1; pointer-events:auto }
    .spinner{ width:48px; height:48px; border-radius:50%; border:3px solid #1f2a37; border-top-color:#00d1ff; animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    /* Pequenos ajustes para telas menores */
    @media (max-width:380px){
      .inner{ padding:8px 10px }
      .icon{ width:56px; height:56px; border-radius:16px }
      .title{ font-size:1rem }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="inner">
      <div class="logo" aria-hidden="true"></div>
      <div style="flex:1">
        <div class="kicker">Dual.Infodose • ASSERT</div>
        <h1>Hub • Home</h1>
      </div>
      <div class="seg" role="tablist" aria-label="Tema">
        <button class="tbtn active" id="themeCyan" role="tab" aria-selected="true">ASSERT</button>
        <button class="tbtn" id="themeLux" role="tab" aria-selected="false">Lux</button>
      </div>
    </div>
  </header>

  <main>
    <div class="grid" id="cards" aria-live="polite" aria-busy="true"></div>
  </main>

  <footer>Hub ASSERT • Central Dual.Infodose</footer>

  <div class="viewer" id="viewer" aria-hidden="true">
    <div class="frame">
      <div class="bar">
        <div class="left"><div class="dot"></div><strong class="barTitle" id="barTitle">App</strong></div>
        <div class="row" style="grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px; width: min(420px, 92vw);">
          <button class="btn secondary" id="btnHome" aria-label="Fechar e voltar para Home">Fechar</button>
          <a class="btn" id="btnExternal" href="#" target="_blank" rel="noopener" aria-label="Abrir em nova aba">Abrir em aba</a>
        </div>
      </div>
      <div class="loader" id="loader"><div class="spinner" role="progressbar" aria-label="Carregando"></div></div>
      <iframe class="iframe" id="appFrame" src="about:blank" title="App em exibição"></iframe>
    </div>
  </div>

<script>
(async function(){
  const cardsRoot = document.getElementById('cards');

  async function loadApps(){
    try{
      const res = await fetch('./apps/apps.json', {cache:'no-store'});
      const data = await res.json();
      renderCards(data.apps||[]);
      cardsRoot.setAttribute('aria-busy','false');
    }catch(e){
      cardsRoot.innerHTML = '<div style="padding:14px;color:#a7c1cc">Não foi possível carregar a lista de apps.</div>';
      cardsRoot.setAttribute('aria-busy','false');
    }
  }

  function renderCards(apps){
    cardsRoot.innerHTML = '';
    apps.forEach(app=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="icon"><img src="${app.icon||'icons/icon-192.png'}" alt="" style="width:100%;height:100%;object-fit:cover"/></div>
        <div style="flex:1">
          <div class="title">${app.title||app.key}</div>
          <div class="muted">${app.desc||''}</div>
          <div class="row">
            <button class="btn" data-open="${app.key}">Abrir no Hub</button>
            <button class="btn secondary" data-open="${app.key}" data-newtab="1">Abrir em aba</button>
          </div>
        </div>`;
      cardsRoot.appendChild(card);
    });
    document.querySelectorAll('[data-open]').forEach(b=>{
      b.onclick = ()=>{
        const key = b.getAttribute('data-open');
        const newtab = b.hasAttribute('data-newtab');
        openByKey(key, newtab, apps);
      };
    });
  }

  // Viewer + swipe down to close
  const viewer = document.getElementById('viewer');
  const frame  = document.getElementById('appFrame');
  const barTitle = document.getElementById('barTitle');
  const btnExternal = document.getElementById('btnExternal');
  const loader = document.getElementById('loader');

  function openApp(app, newtab=false){
    if(newtab){ window.open(app.url, '_blank', 'noopener'); return; }
    barTitle.textContent = app.title||app.key;
    btnExternal.href = app.url;
    loader.classList.add('show');
    frame.onload = ()=> setTimeout(()=> loader.classList.remove('show'), 140);
    frame.src = app.url;
    viewer.classList.add('show');
    viewer.setAttribute('aria-hidden','false');
    localStorage.setItem('hub.last', app.key);
    location.hash = '#app=' + app.key;
  }
  function openByKey(key, newtab, apps){
    const app = (apps||[]).find(x=>x.key===key);
    if(app) openApp(app, newtab);
  }
  document.getElementById('btnHome').onclick = closeViewer;
  function closeViewer(){
    frame.src = 'about:blank';
    viewer.classList.remove('show');
    viewer.setAttribute('aria-hidden','true');
    history.pushState('', document.title, window.location.pathname + window.location.search);
  }

  // Swipe down gesture
  let startY = null, currentY = null, swiping = false;
  viewer.addEventListener('touchstart', (e)=>{
    startY = e.touches[0].clientY; swiping = true;
  }, {passive:true});
  viewer.addEventListener('touchmove', (e)=>{
    if(!swiping) return;
    currentY = e.touches[0].clientY;
    const dy = currentY - startY;
    if(dy>0){
      const t = Math.min(dy, 160);
      viewer.style.transform = `translateY(${t}px)`;
      viewer.style.opacity = String(1 - Math.min(dy/220, 0.4));
    }
  }, {passive:true});
  viewer.addEventListener('touchend', ()=>{
    if(!swiping) return;
    const dy = (currentY??0) - (startY??0);
    viewer.style.transform = ''; viewer.style.opacity = '';
    swiping = false;
    if(dy>90) closeViewer();
  });

  // THEME segmented
  const root = document.body;
  const btnC = document.getElementById('themeCyan');
  const btnL = document.getElementById('themeLux');
  function applyTheme(t){
    root.classList.toggle('theme-lux', t==='lux');
    localStorage.setItem('hub.theme', t);
    btnC.classList.toggle('active', t!=='lux');
    btnL.classList.toggle('active', t==='lux');
    btnC.setAttribute('aria-selected', String(t!=='lux'));
    btnL.setAttribute('aria-selected', String(t==='lux'));
  }
  const saved = localStorage.getItem('hub.theme') || 'assert';
  applyTheme(saved);
  btnC.onclick=()=>applyTheme('assert');
  btnL.onclick=()=>applyTheme('lux');

  // PWA install (mantido)
  if('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js')); }
  let deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; });
  // instalar: usar gesto do usuário
  document.addEventListener('click', async (ev)=>{
    if((ev.target as HTMLElement).id === 'btnInstall' && deferredPrompt){
      deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null;
    }
  });

  // hash-resume
  async function checkHash(){
    try{
      const res = await fetch('./apps/apps.json', {cache:'no-store'});
      const data = await res.json();
      const apps = data.apps||[];
      const h = new URLSearchParams(location.hash.slice(1));
      if(h.has('resume')){
        const last = localStorage.getItem('hub.last');
        const app = apps.find(x=>x.key===last);
        if(app) openApp(app,false);
        return;
      }
      const key = h.get('app');
      if(key){ openByKey(key,false,apps); }
    }catch(_){}
  }
  window.addEventListener('hashchange', checkHash);

  await loadApps(); await checkHash();
})();
</script>
</body>
</html>
